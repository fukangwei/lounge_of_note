---
title: IEEE 802.15.4地址变为IPv6地址
categories: CC2530和zigbee笔记
date: 2019-03-12 09:58:01
---
### MAC48地址变为IPv6地址

&emsp;&emsp;在`IPv6`中，有一种称为无状态自动配置的机制，它可以使用`EUI-64`地址来自动配置`IPv6`地址。`EUI-64`格式即扩展唯一标识符，相当于`MAC48`地址。所谓无状态自动配置是指在网络中没有`DHCP`服务器的情况下，允许节点自行配置`IPv6`地址的机制。<!--more-->
&emsp;&emsp;工作原理：自动将`48bit`的以太网`MAC`地址扩展成`64bit`，再挂在一个`64bit`的前缀后面，组成一个`IPv6`地址，步骤共有三步：

1. 将`48`位的`MAC`地址从中间分开，插入一个固定数值`FFFE`(`16`进制)。
2. 将第`7`个比特位反转，如果原来是`0`就变为`1`，如果原来是`1`就变为`0`。
3. 加上`64`位的网络前缀，这就是一个完整的`IPv6`地址。

&emsp;&emsp;反转原因：在`MAC`地址中，第`7`比特为`1`表示本地管理，为`0`表示全球管理；在`EUI-64`格式中，第`7`位为`1`表示全球唯一，为`0`表示本地唯一。

<img src="./IEEE 802.15.4地址变为IPv6地址/1.png" height="294" width="445">

<p align="center" style="color:green">图1 IPv6和EUI-64地址变化</p>

&emsp;&emsp;1. 原`MAC48`地址为`39-A7-94-07-CB-D0`，从中间断开插入`FF-FE`，变为`39-A7-94-FF-FE-07-CB-D0`。
&emsp;&emsp;2. 第`7`个比特反转(从左往右数)，变为`3B-A7-94-FF-FE-07-CB-D0`。
&emsp;&emsp;3. 加入网络前缀。若前缀为链路本地地址，则网络前缀为`FE-80-00-00-00-00`。`IPv6`地址最终为`FE-80-00-00-00-00-00-00-3B-A7-94-FF-FE-07-CB-D0`，可简写为`FE80::3BA7:94FF:FE07:CBD0`。

### IEEE 802.15.4地址变为IPv6地址

&emsp;&emsp;`CC2530`符合`IEEE 802.15.4`标准，在出厂时便有一个`IEEE`地址。`IEEE 802.15.4`地址共有`8`字节(`IEEE 802.15.4`分为长地址`8`字节和短地址`2`字节)。由于`CC2530`的`IEEE`地址共有`8`字节，扩展`IPv6`地址时便可省略上文提到的步骤`1`，只执行步骤`2`和步骤`3`即可。
&emsp;&emsp;使用`SmartRF Flash Programmer`便可获得`CC2530`地址，通过`CC2530`仿真器连接`CC2530`目标板即可。此时`CC2530`的`IEEE`地址为`00-12-4B-00-02-6E-7D-AA`，那么链路本地地址为`FE-80-00-00-00-00-00-00-02-12-4B-00-02-6E-7D-AA`，请注意`IEEE`地址的首字节`00`被翻转为`02`，可简写为`FE80::212:4B00:26E:7DAA`。

<img src="./IEEE 802.15.4地址变为IPv6地址/2.jpg" height="251" width="288">

<p align="center" style="color:green">图2 CC2530的IEEE地址</p>